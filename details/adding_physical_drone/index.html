<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="../../img/favicon.ico" rel="shortcut icon"/>
<title>Adding A New Vehicle - Project Starling</title>
<link href="../../css/theme.css" rel="stylesheet"/>
<link href="../../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<link href="../../kbd.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "Adding A New Vehicle";
        var mkdocs_page_input_path = "details/adding_physical_drone.md";
        var mkdocs_page_url = null;
      </script>
<script defer="" src="../../js/jquery-3.6.0.min.js"></script>
<!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../.."> Project Starling
        </a><div role="search">
<form action="../../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../..">Overview</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/getting-started/">Getting Started</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../background/">Background</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other/related_projects_and_links/">Ecosystem</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/introduction/">1. Introduction to Starling</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/cli/">2. The Starling CLI</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Single Drone User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/single-drone-local-machine/">Single Drone Simulation on Local Machine</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/kube-single-drone-local-machine/">Single Drone Simulation on Local Cluster</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/single-drone-drones/">Single Drone on Hardware</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Multiple Drone User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/multiple-drone-local-machine/">Multiple Drones Simulation on Local Cluster</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/multiple-drone-drones/">Multiple Drones on Hardware</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Simulation and SITL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/different_vehicles/">Spawning Different Vehicles and Objects</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Additional Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/windows-support/">Windows Support and FAQ</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/writing-a-controller/">Developing a controller</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/development/">Development Guide</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docker/">Understanding Docker</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes/">Understanding Kubernetes</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes-dashboard/">Kubernetes Dashboard Guide</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Physical Flight</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../flight_arena/">BRL Flight Arena</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="./">Adding A New Vehicle</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#vehicle-specification">23.1 Vehicle Specification</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#aerial-vehicles">23.1.1 Aerial Vehicles</a>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-vehicle-to-starling">23.2 Adding a new vehicle to Starling</a>
<ul>
<li class="toctree-l3"><a class="reference internal" href="#companion-computer-boot-image">23.2.1 Companion Computer Boot Image</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vehicle-specific-setup">23.2.2 Vehicle Specific Setup</a>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-vehicle-as-a-node">23.2.3 Adding vehicle as a node.</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Implementation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/example-controller/">Example Python Controller</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes-deployment/">Example Kubernetes Deployments</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../build_system/">Build System</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Image Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/ui/">starling-ui</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/mavros/">starling-mavros</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/controller-base/">starling-controller-base</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/sim-base-core/">starling-sim-base-core</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/sim-base-px4/">starling-sim-base-px4</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/sim-ardupilot-vehicle/">starling-sim-ardupilot-copter/plane</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/sim-ardupilot-gazebo/">starling-sim-ardupilot-gazebo</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/sim-iris-ap/">starling-sim-iris-ap</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker-images/starling-vicon/">starling-vicon</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../other/ideas/">Ideas</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other/MATLAB/">MATLAB (unstable)</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../..">Project Starling</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a alt="Docs" class="icon icon-home" href="../.."></a> »</li>
<li>Physical Flight »</li><li>Adding A New Vehicle</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/UoBFlightLab/ProjectStarling/edit/master/docs/details/adding_physical_drone.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="setting-up-a-new-vehicles-for-the-flight-arena"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.</span> Setting up a new Vehicles for the flight arena<a class="headerlink" href="#setting-up-a-new-vehicles-for-the-flight-arena" title="Permanent link">¶</a></h1>
<div class="toc">
<ul>
<li><a href="#setting-up-a-new-vehicles-for-the-flight-arena">23. Setting up a new Vehicles for the flight arena</a><ul>
<li><a href="#vehicle-specification">23.1 Vehicle Specification</a><ul>
<li><a href="#aerial-vehicles">23.1.1 Aerial Vehicles</a></li>
</ul>
</li>
<li><a href="#adding-a-new-vehicle-to-starling">23.2 Adding a new vehicle to Starling</a><ul>
<li><a href="#companion-computer-boot-image">23.2.1 Companion Computer Boot Image</a></li>
<li><a href="#vehicle-specific-setup">23.2.2 Vehicle Specific Setup</a></li>
<li><a href="#adding-vehicle-as-a-node">23.2.3 Adding vehicle as a node.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="vehicle-specification"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.1</span> Vehicle Specification<a class="headerlink" href="#vehicle-specification" title="Permanent link">¶</a></h2>
<p>Starling can be made compatible with almost all vehicles both ground and aerial. In the majority of cases, a vehicle is valid if it has enough compute to run docker containers and connect to the network. The recommended minimum is a Raspberry Pi 4 with 2Gb RAM with WiFi connectivity. The compute should be sufficient such that all the containers can be run safely without saturating the CPU, Memory or Netowrk Bandwidth. </p>
<h3 id="aerial-vehicles"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.1.1</span> Aerial Vehicles<a class="headerlink" href="#aerial-vehicles" title="Permanent link">¶</a></h3>
<p>The current system is designed with a PX4/Ardupilot compatible flight control (such as a Pixhawk or PixRacer) running in tandem with a companion computer such as a Raspberry Pi. </p>
<p>The current risk assessment covers multi-vehicle flight for vehicles &lt; 1kg maximum take off mass. </p>
<h2 id="adding-a-new-vehicle-to-starling"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.2</span> Adding a new vehicle to Starling<a class="headerlink" href="#adding-a-new-vehicle-to-starling" title="Permanent link">¶</a></h2>
<blockquote>
<p>Note: You will need SSH access to the flight arena server. </p>
</blockquote>
<h3 id="companion-computer-boot-image"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.2.1</span> Companion Computer Boot Image<a class="headerlink" href="#companion-computer-boot-image" title="Permanent link">¶</a></h3>
<p>We have created a custom image which contains the minimum general elements to be compatible with Starling. The image has been generated using the code in the <a href="https://github.com/UoBFlightLab/pi-gen/tree/starling-64-mod">starling-64-mod branch of UobFlightLab/pi-gen</a>. We have released a precompiled image file which can be flashed onto a USB or SD-card and booted from using a tool such as the <a href="https://www.raspberrypi.org/software/">Raspberry Pi Imager</a></p>
<p>The image is based on Ubuntu 20.04 for ARM chips (Raspberry Pi), and has the following elements: </p>
<ul>
<li>Password-less sudo</li>
<li>Automatic connectivity to the Flight Arena LAN</li>
<li>k3s airgapped installation files placed into root with <code>k3s_install.sh</code> executable</li>
<li>GPIO drivers installed </li>
<li>To ensure connectivity with the pixhawk, <a href="https://github.com/CopterExpress/clover/blob/master/clover/udev/99-px4fmu.rules"><code>99-px4fmu.rules</code></a> has been added to <code>/lib/udev/rules.d</code> to ensure the pixhwak is connected via <code>/dev/px4fmu</code>.</li>
<li><code>Chrony</code> library has been installed and that <code>/etc/chonry/chonry.conf</code> is configured to use the flight arena server at <code>192.168.10.80</code> <a href="../flight_arena#time-synchronisation">(see the BRL flight arena doc)</a></li>
<li>The Docker Daemon registry mirrors has been set via <code>/etc/docker/daemon.json</code> to use the flight arena server at <code>192.168.10.80:5000</code> to ensure the drone can pull docker images from the internet. <a href="../flight_arena#docker-local-registry-as-a-pass-through-cache">(see the BRL flight arena doc)</a></li>
</ul>
<h3 id="vehicle-specific-setup"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.2.2</span> Vehicle Specific Setup<a class="headerlink" href="#vehicle-specific-setup" title="Permanent link">¶</a></h3>
<p>A vehicle ID number from 10 to 255 must be chosen. IDs below 10 are reserved. It must be checked that IDs do not clash with existing vehicles (i.e. the Coex Clover drones take ids 11 - 14). </p>
<p>If the vehicle is going to be used with PX4 or Ardupilot, the flight controller system id should be chaned to the vehicle ID. e.g. setting <code>MAV_SYS_ID</code> in QGroundControl for Px4 based systems.</p>
<p>If the vehicle is going to be used with the <a href="../starling-mavros#running-on-a-vehicle">Mavros Container</a>, a <code>/etc/starling/vehicle.config</code> file is required. An example is the following:</p>
<pre><code>VEHICLE_FCU_URL=serial:///dev/px4fmu:115200
VEHICLE_FIRMWARE=px4
VEHICLE_MAVLINK_SYSID=23
VEHICLE_NAME=clover23
</code></pre>
<h3 id="adding-vehicle-as-a-node"><span class="enumerate-headings-plugin enumerate-heading-plugin">23.2.3</span> Adding vehicle as a node.<a class="headerlink" href="#adding-vehicle-as-a-node" title="Permanent link">¶</a></h3>
<p>The vehicle can now be added as a node to the cluster. </p>
<ol>
<li>Ensure that the vehicle is only connected to the LAN either by WIFI or Ethernet. </li>
<li>Identify the IP address of the vehicle by going to the DHCP server on <code>192.168.10.252</code>, or other means</li>
<li>SSH into the flying server and <code>cd</code> into the <code>ProjectStarling/scripts</code> directory</li>
<li>
<p>Run the agent setup script <code>start_k3s_agent.sh</code>. This will ssh into the vehicle and run the setup script with the keys held by the server. <a href="../kubernetes-deployment#pi-drone-agent">See this doc</a> for more details.</p>
<p><code>./start_k3s_agent.sh &lt;remote username&gt; &lt;remote ip address&gt; &lt;node name&gt;</code></p>
<p>e.g. <code>./start_k8_agent.sh ubuntu 192.168.0.110 clover1</code></p>
</li>
<li>
<p>Add the following tags to the node either through the edit functionality in the kubernetes dashboard (the pencil in the upper right corner) or manually through the command line. The tag keys must be fixed, but the values can be varied depending on application. These are required for automatic deployment of containers.</p>
</li>
</ol>
<pre><code>starling.dev/type: vehicle
starling.dev/vehicle-class: rotary
starling.dev/vehicle-type: clover
</code></pre>
<p>The vehicle should now be visible under <code>nodes</code> on the Kubernetes dashboard.</p>
</div>
</div><footer>
<div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-left" href="../flight_arena/" title="BRL Flight Arena"><span class="icon icon-circle-arrow-left"></span> Previous</a>
<a class="btn btn-neutral float-right" href="../../guide/example-controller/" title="Example Python Controller">Next <span class="icon icon-circle-arrow-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
<p>Copyright © 2021 University of Bristol Flight Laboratory</p>
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span>
<a class="fa fa-github" href="https://github.com/UoBFlightLab/ProjectStarling" style="color: #fcfcfc"> GitHub</a>
</span>
<span><a href="../flight_arena/" style="color: #fcfcfc">« Previous</a></span>
<span><a href="../../guide/example-controller/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '../..';</script>
<script defer="" src="../../js/theme_extra.js"></script>
<script defer="" src="../../js/theme.js"></script>
<script defer="" src="../../search/main.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
